
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>bimpy.bStackHeader &#8212; bImPy 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for bimpy.bStackHeader</h1><div class="highlight"><pre>
<span></span><span class="c1"># Author: Robert Cudmore</span>
<span class="c1"># Date: 20190424</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Load converted headers with bStackHeader._loadHeaderFromConverted(scopeFIlePath)</span>

<span class="sd">Converted header .txt file looks like this</span>

<span class="sd">path=e:\\cudmore\\data\\20190429\\20190429_tst2\\20190429_tst2_0001.oir</span>
<span class="sd">date=2019-04-29</span>
<span class="sd">time=13:29:47.578-07:00</span>
<span class="sd">fileVersion=2.1.2.3</span>
<span class="sd">programVersion=2.3.1.163</span>
<span class="sd">laserWavelength=920.0</span>
<span class="sd">pmt1_gain=1.0</span>
<span class="sd">pmt1_offset=0.0</span>
<span class="sd">pmt1_voltage=499.0</span>
<span class="sd">pmt2_gain=None</span>
<span class="sd">pmt2_offset=None</span>
<span class="sd">pmt2_voltage=None</span>
<span class="sd">scanner=Resonant</span>
<span class="sd">zoom=1.0</span>
<span class="sd">bitsPerPixel=10</span>
<span class="sd">numChannels=2</span>
<span class="sd">stackType=TSeries</span>
<span class="sd">xPixels=512</span>
<span class="sd">yPixels=512</span>
<span class="sd">numImages=500</span>
<span class="sd">numFrames=500</span>
<span class="sd">xVoxel=0.994368911043582</span>
<span class="sd">yVoxel=0.994368911043582</span>
<span class="sd">zVoxel=1.0</span>
<span class="sd">frameSpeed=1086.534</span>
<span class="sd">lineSpeed=2.118</span>
<span class="sd">pixelSpeed=0.002</span>
<span class="sd">xMotor=None</span>
<span class="sd">yMotor=None</span>
<span class="sd">zMotor=None</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>

<span class="c1">#import javabridge</span>
<span class="kn">import</span> <span class="nn">bioformats</span>

<span class="kn">import</span> <span class="nn">xml</span>
<span class="kn">import</span> <span class="nn">xml.dom.minidom</span> <span class="c1"># to pretty print</span>

<span class="kn">import</span> <span class="nn">bimpy</span>
<span class="c1">#from bimpy import bFileUtil</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="bStackHeader"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader">[docs]</a><span class="k">class</span> <span class="nc">bStackHeader</span><span class="p">:</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

		<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;constructor&#39;</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">initHeader</span><span class="p">()</span>

		<span class="n">fu</span> <span class="o">=</span> <span class="n">bimpy</span><span class="o">.</span><span class="n">bFileUtil</span><span class="p">()</span>
		<span class="n">convertedStackHeaderPath</span> <span class="o">=</span> <span class="n">fu</span><span class="o">.</span><span class="n">getHeaderFileFromRaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">convertedStackHeaderPath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1"># lead from converted stack header .txt file</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_loadHeaderFromConverted</span><span class="p">(</span><span class="n">convertedStackHeaderPath</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.oir&#39;</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">readOirHeader</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning: bStackHeader.__init__() did not load header&#39;</span><span class="p">)</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	def getHeaderFromDict(self, igorImportDict):</span>
<span class="sd">		&quot;&quot;&quot;</span>
<span class="sd">		Used to import video from Igor canvas</span>
<span class="sd">		theDict: created in bCanvas.importIgorCanvas()</span>
<span class="sd">		&quot;&quot;&quot;</span>
<span class="sd">		fullFileName = os.path.basename(self.path)</span>
<span class="sd">		baseFileName, extension = os.path.splitext(fullFileName)</span>
<span class="sd">		if baseFileName in igorImportDict.keys():</span>
<span class="sd">			self._header = igorImportDict[baseFileName] # may fail</span>
<span class="sd">		else:</span>
<span class="sd">			print(&#39;bStack.getHeaderFromDict() did not find imported header information for file:&#39;, self.path)</span>
<span class="sd">	&#39;&#39;&#39;</span>

<div class="viewcode-block" id="bStackHeader.importVideoHeaderFromIgor"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader.importVideoHeaderFromIgor">[docs]</a>	<span class="k">def</span> <span class="nf">importVideoHeaderFromIgor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">igorImportDict</span><span class="p">):</span>
		<span class="n">fullFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="n">baseFileName</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fullFileName</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">baseFileName</span> <span class="ow">in</span> <span class="n">igorImportDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">igorImportDict</span><span class="p">[</span><span class="n">baseFileName</span><span class="p">]</span> <span class="c1"># may fail</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bStackHeader.importVideoHeaderFromIgor() did not find imported header information for file:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span></div>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">stackType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;stackType&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">numChannels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numChannels&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">numImages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">numFrames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">pixelsPerLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xPixels&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">linesPerFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yPixels&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">xVoxel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xVoxel&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">yVoxel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yVoxel&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">zVoxel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;zVoxel&#39;</span><span class="p">]</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">bitDepth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">bitsPerPixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;bitsPerPixel&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">bitsPerPixel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">bitsPerPixel</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   error: bStackHeader.bitDepth got bad bitsPerPixel:&#39;</span><span class="p">,</span> <span class="n">bitsPerPixel</span><span class="p">,</span> <span class="s1">&#39;returning 8, path:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
			<span class="n">bitsPerPixel</span> <span class="o">=</span> <span class="mi">8</span>
		<span class="k">return</span> <span class="n">bitsPerPixel</span>

	<span class="k">def</span> <span class="nf">_loadHeaderFromConverted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">convertedStackHeaderPath</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Load header from coverted header .txt file&quot;&quot;&quot;</span>

		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bStackHeader._loadHeaderFromConverted() convertedStackHeaderPath:&#39;</span><span class="p">,</span> <span class="n">convertedStackHeaderPath</span><span class="p">)</span>
		<span class="c1"># clear our existing header</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">initHeader</span><span class="p">()</span>

		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">convertedStackHeaderPath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		print(&#39;bStackHeader._loadHeaderFromConverted() is loading header information from .txt file:&#39;, convertedStackHeaderPath)</span>
<span class="sd">		with open(convertedStackHeaderPath, &#39;r&#39;) as file:</span>
<span class="sd">			lines = file.readlines()</span>
<span class="sd">		# remove whitespace characters like `\n` at the end of each line</span>
<span class="sd">		lines = [x.strip() for x in lines]</span>

<span class="sd">		# clear our existing header</span>
<span class="sd">		self.initHeader()</span>

<span class="sd">		# parse what we just read</span>
<span class="sd">		for line in lines:</span>
<span class="sd">			lhs, rhs = line.split(&#39;=&#39;)</span>
<span class="sd">			self.header[lhs] = rhs</span>

<span class="sd">		######</span>
<span class="sd">		## FIX THIS</span>
<span class="sd">		######</span>
<span class="sd">		#print(&#39;bStackHeader._loadHeaderFromConverted() *** TODO *** add umWidth and umHeight to original conversion !!!!!&#39;)</span>
<span class="sd">		#print(&#39;   also need to figure out str versus int versus float !!!!&#39;)</span>
<span class="sd">		# todo: add this to original python/fiji scripts that convert header</span>
<span class="sd">		# add (umWidth, umHeight)</span>
<span class="sd">		# x</span>
<span class="sd">		#if &#39;umWidth&#39; not in self.header.keys():</span>
<span class="sd">		if 1:</span>
<span class="sd">			xPixels = int(self.header[&#39;xPixels&#39;])</span>
<span class="sd">			xVoxel = float(self.header[&#39;xVoxel&#39;])</span>
<span class="sd">			umWidth = xPixels * xVoxel</span>
<span class="sd">			self.header[&#39;umWidth&#39;] = umWidth</span>
<span class="sd">		# y</span>
<span class="sd">		#if &#39;umHeight&#39; not in self.header.keys():</span>
<span class="sd">		if 1:</span>
<span class="sd">			yPixels = int(self.header[&#39;yPixels&#39;])</span>
<span class="sd">			yVoxel = float(self.header[&#39;yVoxel&#39;])</span>
<span class="sd">			umHeight = yPixels * yVoxel</span>
<span class="sd">			self.header[&#39;umHeight&#39;] = umHeight</span>
<span class="sd">		&#39;&#39;&#39;</span>

<div class="viewcode-block" id="bStackHeader.prettyPrint"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader.prettyPrint">[docs]</a>	<span class="k">def</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   file:&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
			<span class="s1">&#39;stackType:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackType</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
			<span class="s1">&#39;channels:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numChannels</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
			<span class="s1">&#39;images:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numImages</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
			<span class="s1">&#39;x/y pixels:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelsPerLine</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">linesPerFrame</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
			<span class="s1">&#39;x/y um/pixel:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xVoxel</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yVoxel</span><span class="p">,</span>
			<span class="p">)</span></div>

<div class="viewcode-block" id="bStackHeader.getMetaData"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader.getMetaData">[docs]</a>	<span class="k">def</span> <span class="nf">getMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Get all header items as text in a single line&quot;&quot;&quot;</span>
		<span class="n">ijmetadataStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="n">ijmetadataStr</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">return</span> <span class="n">ijmetadataStr</span></div>

<div class="viewcode-block" id="bStackHeader.saveHeader"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader.saveHeader">[docs]</a>	<span class="k">def</span> <span class="nf">saveHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headerSavePath</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; Save the header as a .txt file to the path&quot;&quot;&quot;</span>
		<span class="c1"># todo: check that the path exists</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">headerSavePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
			<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="bStackHeader.initHeader"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader.initHeader">[docs]</a>	<span class="k">def</span> <span class="nf">initHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="c1"># full path to the file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;olympusFileVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># Of the Olympus software</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;olympusProgramVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># Of the Olympus software</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;laserWavelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;laserPercent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>

		<span class="c1"># 1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtGain1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtOffset1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtVoltage1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="c1"># 2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtGain2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtOffset2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtVoltage2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="c1"># 3</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtGain3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtOffset3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtVoltage3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;scanner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;zoom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># optical zoom of objective</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;bitsPerPixel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numChannels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;stackType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xVoxel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># um/pixel</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yVoxel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;zVoxel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;umWidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;umHeight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;frameSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;lineSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># time of each line scan (ms)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pixelSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xMotor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yMotor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;zMotor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="bStackHeader.assignToShape"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader.assignToShape">[docs]</a>	<span class="k">def</span> <span class="nf">assignToShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;shape is (channels, slices, x, y)&quot;&quot;&quot;</span>
		<span class="n">shape</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">shape</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
			<span class="c1"># single plane image</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numChannels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
			<span class="c1"># 3d image volume</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numChannels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   error: bStackHeader.assignToShape() got bad shape:&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
		<span class="n">dtype</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">dtype</span>
		<span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;uint8&#39;</span><span class="p">:</span>
			<span class="n">bitDepth</span> <span class="o">=</span> <span class="mi">8</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">bitDepth</span> <span class="o">=</span> <span class="mi">16</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;bitsPerPixel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitDepth</span></div>

<div class="viewcode-block" id="bStackHeader.readOirHeader"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackHeader.bStackHeader.readOirHeader">[docs]</a>	<span class="k">def</span> <span class="nf">readOirHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read header information from xml. This is not pretty.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1">#print(&#39;bStackHeader.readOirHeader()&#39;)</span>
		<span class="k">def</span> <span class="nf">_qn</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">):</span>
			<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			xml helper. Return the qualified name for a given namespace and tag name</span>
<span class="sd">			This is the ElementTree representation of a qualified name</span>
<span class="sd">			&#39;&#39;&#39;</span>
			<span class="k">return</span> <span class="s2">&quot;{</span><span class="si">%s</span><span class="s2">}</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>

			<span class="c1">#print(&#39;=== StackHeader.readOirHeader() log errors will be here&#39;)</span>
			<span class="c1">#</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;readOirHeader() self.path:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
			<span class="n">metaData</span> <span class="o">=</span> <span class="n">bioformats</span><span class="o">.</span><span class="n">get_omexml_metadata</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
			<span class="n">omeXml</span> <span class="o">=</span> <span class="n">bioformats</span><span class="o">.</span><span class="n">OMEXML</span><span class="p">(</span><span class="n">metaData</span><span class="p">)</span>

			<span class="c1"># leave this here, will extract ome-xml as pretty printed string</span>
			<span class="c1">#print(&#39;omeXml:&#39;, omeXml.prettyprintxml())</span>
			<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			pretty_xml = xml.dom.minidom.parseString(str(omeXml))</span>
<span class="sd">			print(pretty_xml.toprettyxml())</span>
<span class="sd">			sys.exit()</span>
<span class="sd">			&#39;&#39;&#39;</span>

			<span class="c1"># this does not work, always gives us time as late in the PM?</span>
			<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			dateTime = omeXml.image().AcquisitionDate</span>
<span class="sd">			print(&#39;dateTime:&#39;, dateTime)</span>
<span class="sd">			date, time = dateTime.split(&#39;T&#39;)</span>
<span class="sd">			self.header[&#39;date&#39;] = date</span>
<span class="sd">			self.header[&#39;time&#39;] = time</span>
<span class="sd">			&#39;&#39;&#39;</span>

			<span class="n">instrumentObject</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">instrument</span><span class="p">()</span>
			<span class="n">laserElement</span> <span class="o">=</span> <span class="n">instrumentObject</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">_qn</span><span class="p">(</span><span class="n">instrumentObject</span><span class="o">.</span><span class="n">ns</span><span class="p">[</span><span class="s1">&#39;ome&#39;</span><span class="p">],</span> <span class="s2">&quot;Laser&quot;</span><span class="p">))</span> <span class="c1"># laserElement is a &#39;xml.etree.ElementTree.Element&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;laserWavelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">laserElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">)</span>

			<span class="c1"># todo: how do i get info from detector 1 and 2 ???</span>
			<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			self.header[&#39;pmt1_gain&#39;] = omeXml.instrument().Detector.node.get(&quot;Gain&quot;) #</span>
<span class="sd">			self.header[&#39;pmt1_offset&#39;] = omeXml.instrument().Detector.node.get(&quot;Offset&quot;) #</span>
<span class="sd">			self.header[&#39;pmt1_voltage&#39;] = omeXml.instrument().Detector.node.get(&quot;Voltage&quot;) #</span>
<span class="sd">			&#39;&#39;&#39;</span>

			<span class="n">numChannels</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">channel_count</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numChannels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numChannels</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">SizeX</span> <span class="c1"># pixels</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yPixels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">SizeY</span> <span class="c1"># pixels</span>

			<span class="c1"># todo: this is NOT working</span>
			<span class="c1">#self.header[&#39;numImages&#39;] = omeXml.image_count</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">SizeZ</span> <span class="c1"># number of images</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">SizeT</span> <span class="c1"># number of images</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
				<span class="c1">#print(&#39;--------- tmp setting -------- self.header[&quot;stackType&quot;] = &quot;ZStack&quot;&#39;)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;stackType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ZStack&#39;</span> <span class="c1">#&#39;ZStack&#39;</span>

			<span class="c1"># swap numFrames into numImages</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numImages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]</span>
				<span class="c1">#print(&#39;--------- tmp setting -------- self.header[&quot;stackType&quot;] = &quot;TSeries&quot;&#39;)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;stackType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TSeries&#39;</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xVoxel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">PhysicalSizeX</span> <span class="c1"># um/pixel</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yVoxel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">PhysicalSizeY</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;zVoxel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omeXml</span><span class="o">.</span><span class="n">image</span><span class="p">()</span><span class="o">.</span><span class="n">Pixels</span><span class="o">.</span><span class="n">PhysicalSizeZ</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;umWidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xPixels&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;xVoxel&#39;</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;umHeight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yPixels&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;yVoxel&#39;</span><span class="p">]</span>

			<span class="n">root</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">omeXml</span><span class="p">))</span>

			<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
			<span class="n">pixelSpeed2</span><span class="p">,</span> <span class="n">pixelSpeed3</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
			<span class="n">lineSpeed2</span><span class="p">,</span> <span class="n">lineSpeed3</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
			<span class="n">frameSpeed2</span><span class="p">,</span> <span class="n">frameSpeed3</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
			<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;StructuredAnnotations&#39;</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">grandchild</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">greatgrandchild</span> <span class="ow">in</span> <span class="n">grandchild</span><span class="p">:</span>
							<span class="k">for</span> <span class="n">greatgreatgrandchild</span> <span class="ow">in</span> <span class="n">greatgrandchild</span><span class="p">:</span>
								<span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
								<span class="n">finalKey</span> <span class="o">=</span> <span class="n">greatgreatgrandchild</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
								<span class="n">finalValue</span> <span class="o">=</span> <span class="n">greatgreatgrandchild</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>

								<span class="c1"># 20190617</span>
								<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">								&lt;ome:OriginalMetadata&gt;</span>
<span class="sd">									&lt;ome:Key&gt;20190613__0028.oir method sequentialType #1&lt;/ome:Key&gt;</span>
<span class="sd">									&lt;ome:Value&gt;Line&lt;/ome:Value&gt;</span>
<span class="sd">								&lt;/ome:OriginalMetadata&gt;</span>
<span class="sd">								&quot;&quot;&quot;</span>
								<span class="c1"># removed 20191029, was not working</span>
								<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">								if &#39;method sequentialType&#39; in finalKey:</span>
<span class="sd">									print(finalKey)</span>
<span class="sd">									print(&#39;   &#39;, finalValue)</span>
<span class="sd">									print(&#39;--------- tmp setting -------- self.header[&quot;stackType&quot;] = &#39;, finalValue)</span>
<span class="sd">									self.header[&#39;stackType&#39;] = finalValue</span>
<span class="sd">								&quot;&quot;&quot;</span>

								<span class="c1"># 20190617, very specific for our scope</span>
								<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">								&lt;ome:OriginalMetadata&gt;</span>
<span class="sd">									&lt;ome:Key&gt;- Laser Chameleon Vision II transmissivity&lt;/ome:Key&gt;</span>
<span class="sd">									&lt;ome:Value&gt;[9.3]&lt;/ome:Value&gt;</span>
<span class="sd">								&lt;/ome:OriginalMetadata&gt;</span>
<span class="sd">								&quot;&quot;&quot;</span>
								<span class="k">if</span> <span class="s1">&#39;- Laser Chameleon Vision II transmissivity&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">finalValue</span> <span class="o">=</span> <span class="n">finalValue</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
									<span class="n">finalValue</span> <span class="o">=</span> <span class="n">finalValue</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;laserPercent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>

								<span class="k">if</span> <span class="s1">&#39;general creationDateTime&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">theDate</span><span class="p">,</span> <span class="n">theTime</span> <span class="o">=</span> <span class="n">finalValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theDate</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theTime</span>

								<span class="k">if</span> <span class="s1">&#39;fileInfomation version #1&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;olympusFileVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;system systemVersion #1&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;olympusProgramVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>

								<span class="k">if</span> <span class="s1">&#39;area zoom&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;zoom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;configuration scannerType&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;scanner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span> <span class="c1"># in (&#39;Resonant&#39;, &#39;Galvano&#39;)</span>
								<span class="k">if</span> <span class="s1">&#39;imageDefinition bitCounts&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;bitsPerPixel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>

								<span class="c1"># channel 1</span>
								<span class="k">if</span> <span class="s1">&#39;pmt gain #1&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtGain1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;pmt offset #1&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtOffset1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;pmt voltage #1&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtVoltage1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="c1"># channel 2</span>
								<span class="k">if</span> <span class="s1">&#39;pmt gain #2&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtGain2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;pmt offset #2&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtOffset2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;pmt voltage #2&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtVoltage2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="c1"># channel 3</span>
								<span class="k">if</span> <span class="s1">&#39;pmt gain #3&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtGain3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;pmt offset #3&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtOffset3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;pmt voltage #3&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pmtVoltage3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalValue</span>

								<span class="c1"># use #2 for Galvano, and #3 for Resonant</span>
								<span class="k">if</span> <span class="s1">&#39;speedInformation pixelSpeed #2&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">pixelSpeed2</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;speedInformation pixelSpeed #3&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">pixelSpeed3</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;speedInformation lineSpeed #2&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">lineSpeed2</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;speedInformation lineSpeed #3&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">lineSpeed3</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;speedInformation frameSpeed #2&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">frameSpeed2</span> <span class="o">=</span> <span class="n">finalValue</span>
								<span class="k">if</span> <span class="s1">&#39;speedInformation frameSpeed #3&#39;</span> <span class="ow">in</span> <span class="n">finalKey</span><span class="p">:</span>
									<span class="n">frameSpeed3</span> <span class="o">=</span> <span class="n">finalValue</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;scanner&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Galvano&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pixelSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pixelSpeed2</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;lineSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineSpeed2</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;frameSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frameSpeed2</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;scanner&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Resonant&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;pixelSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pixelSpeed3</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;lineSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineSpeed3</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;frameSpeed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frameSpeed3</span>

		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exception in bStackHEader.readOirHeader()&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
			<span class="k">raise</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="k">pass</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">bImPy</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Robert H Cudmore.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>