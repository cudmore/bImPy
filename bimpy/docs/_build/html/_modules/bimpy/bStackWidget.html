
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>bimpy.bStackWidget &#8212; bImPy 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for bimpy.bStackWidget</h1><div class="highlight"><pre>
<span></span><span class="c1"># 20190802</span>

<span class="c1"># goal: make a stack window and overlay tracing from deepvess</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">[done] make left tool bar</span>
<span class="sd">[done] make top contrast bar</span>

<span class="sd">[done] make segment selection</span>
<span class="sd">on selecting segment, select in list</span>
<span class="sd">[done] on selecting segment in list, select in image</span>

<span class="sd">take stats on vessel segments</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtWidgets</span>

<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="k">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends</span> <span class="k">import</span> <span class="n">backend_qt5agg</span>

<span class="kn">from</span> <span class="nn">bimpy</span> <span class="k">import</span> <span class="n">bStackContrastWidget</span>
<span class="kn">from</span> <span class="nn">bimpy</span> <span class="k">import</span> <span class="n">bStackFeebackWidget</span>
<span class="kn">from</span> <span class="nn">bimpy</span> <span class="k">import</span> <span class="n">bStack</span>
<span class="c1">#from bSimpleStack import bSimpleStack</span>

<span class="c1">################################################################################</span>
<div class="viewcode-block" id="bAnnotationTable"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bAnnotationTable">[docs]</a><span class="k">class</span> <span class="nc">bAnnotationTable</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">slabList</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">bAnnotationTable</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		self.setObjectName(&#39;bAnnotationTable&#39;)</span>
<span class="sd">		self.setStyleSheet(&quot;&quot;&quot;</span>
<span class="sd">			#bAnnotationTable {</span>
<span class="sd">				background-color: #222;</span>
<span class="sd">			}</span>
<span class="sd">			.QTableWidget {</span>
<span class="sd">				background-color: #222;</span>
<span class="sd">			}</span>
<span class="sd">		&quot;&quot;&quot;)</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span> <span class="o">=</span> <span class="n">mainWindow</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slabList</span> <span class="o">=</span> <span class="n">slabList</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myQVBoxLayout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

		<span class="c1">#</span>
		<span class="c1"># buttons</span>
		<span class="n">mySaveButton</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
		<span class="n">mySaveButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveButton_Callback</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myQVBoxLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">mySaveButton</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myQHBoxLayout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># to hold nodes and edges</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myQVBoxLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myQHBoxLayout</span><span class="p">)</span>

		<span class="c1">#</span>
		<span class="c1"># table of node annotation</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">numNodes</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">numNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">numNodes</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">numNodes</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">setSelectionBehavior</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SelectRows</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">cellClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_clicked_node</span><span class="p">)</span>
		<span class="n">nodeHeaderLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zSlice&#39;</span><span class="p">,</span> <span class="s1">&#39;nEdges&#39;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodeHeaderLabels</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">nodeHeaderLabels</span><span class="p">)</span>
		<span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodeHeaderLabels</span><span class="p">):</span>
			<span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bAnnotationTable num nodes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">nodeDictList</span><span class="p">))</span>
			<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			for tmpNode in self.slabList.nodeDictList:</span>
<span class="sd">				print(&#39;tmpNode:&#39;, tmpNode)</span>
<span class="sd">			&#39;&#39;&#39;</span>
			<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">stat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">nodeDictList</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">colIdx</span><span class="p">,</span> <span class="n">header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodeHeaderLabels</span><span class="p">):</span>
					<span class="n">myString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="n">header</span><span class="p">])</span>
					<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">					# special cases</span>
<span class="sd">					if header == &#39;Bad&#39;:</span>
<span class="sd">						myString = &#39;X&#39; if myString==&#39;True&#39; else &#39;&#39;</span>
<span class="sd">					&#39;&#39;&#39;</span>
					<span class="c1">#assign</span>
					<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">colIdx</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

		<span class="c1">#</span>
		<span class="c1"># table of edge annotations</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">numEdges</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">numEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">numEdges</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">numEdges</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setSelectionBehavior</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SelectRows</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span>
		<span class="c1"># signals/slots</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">cellClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_clicked_edge</span><span class="p">)</span>
		<span class="c1"># todo: this work to select edge when arrow keys are used but casuses bug in interface</span>
		<span class="c1"># figure out how to get this to work</span>
		<span class="c1">#self.myTableWidget.currentCellChanged.connect(self.on_clicked)</span>
		<span class="c1">#headerLabels = [&#39;type&#39;, &#39;n&#39;, &#39;Length 3D&#39;, &#39;Length 2D&#39;, &#39;z&#39;, &#39;preNode&#39;, &#39;postNode&#39;, &#39;Good&#39;]</span>
		<span class="n">headerLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;Len 3D&#39;</span><span class="p">,</span> <span class="s1">&#39;Len 2D&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;preNode&#39;</span><span class="p">,</span> <span class="s1">&#39;postNode&#39;</span><span class="p">,</span> <span class="s1">&#39;Bad&#39;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headerLabels</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">headerLabels</span><span class="p">)</span>
		<span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headerLabels</span><span class="p">):</span>
			<span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
		<span class="c1"># QHeaderView will automatically resize the section to fill the available space.</span>
		<span class="c1"># The size cannot be changed by the user or programmatically.</span>
		<span class="c1">#header.setSectionResizeMode(0, QtWidgets.QHeaderView.Stretch)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">stat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">edgeDictList</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">colIdx</span><span class="p">,</span> <span class="n">header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headerLabels</span><span class="p">):</span>
					<span class="n">myString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="n">header</span><span class="p">])</span>
					<span class="c1"># special cases</span>
					<span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;Bad&#39;</span><span class="p">:</span>
						<span class="n">myString</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span> <span class="k">if</span> <span class="n">myString</span><span class="o">==</span><span class="s1">&#39;True&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
					<span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;preNode&#39;</span><span class="p">:</span>
						<span class="n">myString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">myString</span><span class="o">==</span><span class="s1">&#39;-1&#39;</span> <span class="k">else</span> <span class="n">myString</span>
					<span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;postNode&#39;</span><span class="p">:</span>
						<span class="n">myString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">myString</span><span class="o">==</span><span class="s1">&#39;-1&#39;</span> <span class="k">else</span> <span class="n">myString</span>
					<span class="c1">#assign</span>
					<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">colIdx</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>


		<span class="bp">self</span><span class="o">.</span><span class="n">myQHBoxLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myQHBoxLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="p">)</span>

	<span class="c1"># todo: this is broken</span>
<div class="viewcode-block" id="bAnnotationTable.saveButton_Callback"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bAnnotationTable.saveButton_Callback">[docs]</a>	<span class="k">def</span> <span class="nf">saveButton_Callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Save the current annotation list</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bAnnotationTable.saveButton_Callback()&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="bAnnotationTable.refreshRow"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bAnnotationTable.refreshRow">[docs]</a>	<span class="k">def</span> <span class="nf">refreshRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
		<span class="n">stat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">edgeDictList</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

		<span class="n">myString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

		<span class="n">myString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

		<span class="n">myString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="s1">&#39;Length 3D&#39;</span><span class="p">])</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

		<span class="n">myString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="s1">&#39;Length 2D&#39;</span><span class="p">])</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

		<span class="n">myString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">stat</span><span class="p">[</span><span class="s1">&#39;Good&#39;</span><span class="p">]:</span>
			<span class="n">myString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">myString</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>
		<span class="c1">#myString = str(stat[&#39;Good&#39;])</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">myString</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="bAnnotationTable.selectRow"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bAnnotationTable.selectRow">[docs]</a>	<span class="k">def</span> <span class="nf">selectRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bAnnotationTable.selectRow()&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span></div>

<div class="viewcode-block" id="bAnnotationTable.on_clicked_node"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bAnnotationTable.on_clicked_node">[docs]</a>	<span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">on_clicked_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bAnnotationTable.on_clicked_node&#39;</span><span class="p">)</span>
		<span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myNodeTableWidget</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;selectNodeFromTable&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">fromTable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="bAnnotationTable.on_clicked_edge"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bAnnotationTable.on_clicked_edge">[docs]</a>	<span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
	<span class="k">def</span> <span class="nf">on_clicked_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1">#print(&#39;bAnnotationTable.on_clicked_edge&#39;)</span>
		<span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="c1">#print(&#39;   row:&#39;, row)</span>
		<span class="n">yStat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myTableWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="c1">#</span>
		<span class="c1">#print(&#39;   &#39;, row, yStat)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;selectEdgeFromTable&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">fromTable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>

<span class="c1">################################################################################</span>
<span class="c1">#class bStackView(QtWidgets.QWidget):</span>
<div class="viewcode-block" id="bStackView"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView">[docs]</a><span class="k">class</span> <span class="nc">bStackView</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGraphicsView</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simpleStack</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">bStackView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;bStackView&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">			#bStackView {</span>
<span class="s2">				background-color: #222;</span>
<span class="s2">			}</span>
<span class="s2">		&quot;&quot;&quot;</span><span class="p">)</span>

		<span class="c1">#self.path = path</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">options_defaults</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span> <span class="o">=</span> <span class="n">simpleStack</span> <span class="c1">#bSimpleStack(path)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span> <span class="o">=</span> <span class="n">mainWindow</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">mySelectedNode</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># node index of selected node</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySelectedEdge</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># edge index of selected edge</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span> <span class="o">=</span> <span class="s1">&#39;ch1&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">displaySlidingZ</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">currentSlice</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">minContrast</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">maxContrast</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">getHeaderVal</span><span class="p">(</span><span class="s1">&#39;bitsPerPixel&#39;</span><span class="p">)</span>

		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		self.idMasked = None</span>
<span class="sd">		self.xMasked = None</span>
<span class="sd">		self.yMasked = None</span>
<span class="sd">		self.zMasked = None</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">showTracing</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">showNodes</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">showEdges</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">showDeadEnds</span> <span class="o">=</span> <span class="kc">True</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">imgplot</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="c1"># coordinates of the image</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">iLeft</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">iTop</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">iRight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">xVoxel</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">pixelsPerLine</span> <span class="c1"># reversed</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">iBottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">yVoxel</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">linesPerFrame</span>

		<span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span>
		<span class="n">width</span> <span class="o">=</span> <span class="mi">24</span> <span class="c1">#12</span>
		<span class="n">height</span> <span class="o">=</span> <span class="mi">24</span> <span class="c1">#12</span>

		<span class="c1"># for click and drag</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clickPos</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">_preComputeAllMasks</span><span class="p">()</span>

		<span class="c1">#</span>
		<span class="n">scene</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGraphicsScene</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
		<span class="c1">#self.scene = scene</span>

		<span class="c1"># was this</span>
		<span class="c1"># visually turn off scroll bars</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setVerticalScrollBarPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalScrollBarPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">setTransformationAnchor</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">AnchorUnderMouse</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setResizeAnchor</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">AnchorUnderMouse</span><span class="p">)</span>

		<span class="c1">#self.setBackgroundBrush(QtGui.QBrush(QtGui.QColor(30, 30, 30)))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">NoFrame</span><span class="p">)</span>

		<span class="c1"># image</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">backend_qt5agg</span><span class="o">.</span><span class="n">FigureCanvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1">#remove white border</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="c1">#turn off axis labels</span>

		<span class="c1"># slab/point list</span>
		<span class="n">markersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;tracingPenSize&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;tracingColor&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySlabPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="c1"># nodes (put this after slab/point list to be on top, order matter)</span>
		<span class="n">markersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;nodePenSize&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;nodeColor&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodePlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="c1"># tracing/slabs that are dead end</span>
		<span class="n">markersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;deadEndPenSize&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;deadEndColor&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myDeadEndPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="c1"># node selection</span>
		<span class="n">markersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;nodeSelectionPenSize&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;nodeSelectionColor&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeSelectionPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">)</span>

		<span class="c1"># flash node selection</span>
		<span class="n">markersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;nodeSelectionFlashPenSize&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;nodeSelectionFlashColor&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myNodeSelectionFlash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">)</span>

		<span class="c1"># edge selection</span>
		<span class="n">markersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;tracingSelectionPenSize&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;tracingSelectionColor&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myEdgeSelectionPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">)</span>

		<span class="c1"># flash edge selection</span>
		<span class="n">markersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;tracingSelectionFlashPenSize&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;tracingSelectionFlashColor&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myEdgeSelectionFlash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">)</span>

		<span class="c1">#self.canvas.mpl_connect(&#39;key_press_event&#39;, self.onkey)</span>
		<span class="c1">#self.canvas.mpl_connect(&#39;button_press_event&#39;, self.onclick)</span>
		<span class="c1">#self.canvas.mpl_connect(&#39;scroll_event&#39;, self.onscroll)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onpick</span><span class="p">)</span>

		<span class="c1"># trying this</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		layout = QtWidgets.QVBoxLayout()</span>
<span class="sd">		layout.addWidget(self.canvas)</span>
<span class="sd">		self.setLayout(layout)</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="c1"># was this</span>
		<span class="n">scene</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">setScene</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>

		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sceneRect:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sceneRect</span><span class="p">())</span>
		<span class="c1">#self.setSceneRect(-100, -100, 640+100, 640+100)</span>

<div class="viewcode-block" id="bStackView.flashNode"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.flashNode">[docs]</a>	<span class="k">def</span> <span class="nf">flashNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeIdx</span><span class="p">,</span> <span class="n">numberOfFlashes</span><span class="p">):</span>
		<span class="c1">#todo rewrite this to use a copy of selected edge coordinated, rather than grabbing them each time (slow)</span>
		<span class="c1">#print(&#39;flashEdge() edgeIdx:&#39;, edgeIdx, on)</span>
		<span class="k">if</span> <span class="n">nodeIdx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="n">numberOfFlashes</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">getNode_xyz</span><span class="p">(</span><span class="n">nodeIdx</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">myNodeSelectionFlash</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
				<span class="c1">#</span>
				<span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">flashNode</span><span class="p">(</span><span class="n">nodeIdx</span><span class="p">,</span> <span class="n">numberOfFlashes</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myNodeSelectionFlash</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[],</span> <span class="p">[]])</span>
		<span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span> <span class="c1"># this is updating the widget !!!!!!!!</span></div>

<div class="viewcode-block" id="bStackView.flashEdge"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.flashEdge">[docs]</a>	<span class="k">def</span> <span class="nf">flashEdge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgeIdx</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
		<span class="c1">#todo rewrite this to use a copy of selected edge coordinated, rather than grabbing them each time (slow)</span>
		<span class="c1">#print(&#39;flashEdge() edgeIdx:&#39;, edgeIdx, on)</span>
		<span class="k">if</span> <span class="n">edgeIdx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="n">on</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">theseIndices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">getEdge</span><span class="p">(</span><span class="n">edgeIdx</span><span class="p">)</span>
				<span class="n">xMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">theseIndices</span><span class="p">]</span>
				<span class="n">yMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">theseIndices</span><span class="p">]</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">myEdgeSelectionFlash</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xMasked</span><span class="p">,</span> <span class="n">yMasked</span><span class="p">])</span>
				<span class="c1">#</span>
				<span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">flashEdge</span><span class="p">(</span><span class="n">edgeIdx</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myEdgeSelectionFlash</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[],</span> <span class="p">[]])</span>
		<span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span> <span class="c1"># this is updating the widget !!!!!!!!</span></div>

<div class="viewcode-block" id="bStackView.selectNode"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.selectNode">[docs]</a>	<span class="k">def</span> <span class="nf">selectNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeIdx</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;selectNode() nodeIdx:&#39;</span><span class="p">,</span> <span class="n">nodeIdx</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">nodeIdx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mySelectionNode</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myNodeSelectionPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[],</span> <span class="p">[]])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">mySelectedNode</span> <span class="o">=</span> <span class="n">nodeIdx</span>
				<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">getNode_xyz</span><span class="p">(</span><span class="n">nodeIdx</span><span class="p">)</span>

				<span class="k">if</span> <span class="n">snapz</span><span class="p">:</span>
					<span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">getNode_zSlice</span><span class="p">(</span><span class="n">nodeIdx</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

					<span class="bp">self</span><span class="o">.</span><span class="n">myEdgeSelectionPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

					<span class="bp">self</span><span class="o">.</span><span class="n">zoomToPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

					<span class="n">numberOfFlashes</span> <span class="o">=</span> <span class="mi">1</span>
					<span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">flashNode</span><span class="p">(</span><span class="n">nodeIdx</span><span class="p">,</span> <span class="n">numberOfFlashes</span><span class="p">))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span> <span class="c1"># this is updating the widget !!!!!!!!</span></div>

<div class="viewcode-block" id="bStackView.selectEdge"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.selectEdge">[docs]</a>	<span class="k">def</span> <span class="nf">selectEdge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgeIdx</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="c1">#print(&#39;=== bStackView.selectEdge():&#39;, edgeIdx)</span>
		<span class="k">if</span> <span class="n">edgeIdx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bStackView.selectEdge() --&gt;&gt; NONE&#39;</span><span class="p">)</span>
			<span class="c1">#markersize = 10</span>
			<span class="c1">#self.myEdgeSelectionPlot = self.axes.scatter([], [], marker=&#39;o&#39;, color=&#39;c&#39;, s=markersize, picker=True)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mySelectedEdge</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myEdgeSelectionPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[],</span> <span class="p">[]])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mySelectedEdge</span> <span class="o">=</span> <span class="n">edgeIdx</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">theseIndices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">getEdge</span><span class="p">(</span><span class="n">edgeIdx</span><span class="p">)</span>

				<span class="c1">#print(&#39;selectEdge() theseIndices:&#39;, theseIndices)</span>

				<span class="c1"># todo: add option to snap to a z</span>
				<span class="c1"># removed this because it was confusing</span>
				<span class="k">if</span> <span class="n">snapz</span><span class="p">:</span>
					<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">					z = self.mySimpleStack.slabList.z[theseIndices[0]][0] # not sure why i need trailing [0] ???</span>
<span class="sd">					z = int(z)</span>
<span class="sd">					&#39;&#39;&#39;</span>
					<span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">edgeDictList</span><span class="p">[</span><span class="n">edgeIdx</span><span class="p">][</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
					<span class="n">z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

				<span class="n">xMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">theseIndices</span><span class="p">]</span> <span class="c1"># flipped</span>
				<span class="n">yMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">theseIndices</span><span class="p">]</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">myEdgeSelectionPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xMasked</span><span class="p">,</span> <span class="n">yMasked</span><span class="p">])</span>

				<span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">flashEdge</span><span class="p">(</span><span class="n">edgeIdx</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span> <span class="c1"># this is updating the widget !!!!!!!!</span></div>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	def setSliceContrast(self, sliceNumber):</span>
<span class="sd">		img = self.mySimpleStack._images[sliceNumber, :, :].copy()</span>

<span class="sd">		#print(&#39;setSliceContrast() BEFORE min:&#39;, img.min(), &#39;max:&#39;, img.max(), &#39;mean:&#39;, img.mean(), &#39;dtype:&#39;, img.dtype)</span>

<span class="sd">		maxInt = 2 ** self.mySimpleStack.bitDepth - 1</span>

<span class="sd">		lowContrast = self.minContrast</span>
<span class="sd">		highContrast = self.maxContrast</span>

<span class="sd">		#print(&#39;   setSliceContrast() sliceNumber:&#39;, sliceNumber, &#39;maxInt:&#39;, maxInt, &#39;lowContrast:&#39;, lowContrast, &#39;highContrast:&#39;, highContrast)</span>

<span class="sd">		#mult = maxInt / abs(highContrast - lowContrast)</span>
<span class="sd">		denominator = abs(highContrast - lowContrast)</span>
<span class="sd">		if denominator != 0:</span>
<span class="sd">			mult = maxInt / denominator</span>
<span class="sd">		else:</span>
<span class="sd">			mult = maxInt</span>

<span class="sd">		#img.astype(numpy.uint16)</span>
<span class="sd">		img[img &lt; lowContrast] = lowContrast</span>
<span class="sd">		img[img &gt; highContrast] = highContrast</span>
<span class="sd">		img -= lowContrast</span>

<span class="sd">		img = img * mult</span>
<span class="sd">		img = img.astype(np.uint8)</span>

<span class="sd">		#print(&#39;setSliceContrast() AFTER min:&#39;, img.min(), &#39;max:&#39;, img.max(), &#39;mean:&#39;, img.mean(), &#39;dtype:&#39;, img.dtype, &#39;int(mult):&#39;, int(mult))</span>

<span class="sd">		return img</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">def</span> <span class="nf">_preComputeAllMasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Precompute all masks once. When user scrolls through slices this is WAY faster</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">maskedNodes</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">maskedEdges</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">maskedDeadEnds</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">numImages</span><span class="p">):</span>
			<span class="n">upperz</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;showTracingAboveSlices&#39;</span><span class="p">]</span>
			<span class="n">lowerz</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">][</span><span class="s1">&#39;showTracingBelowSlices&#39;</span><span class="p">]</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="c1">#</span>
				<span class="c1"># nodes</span>
				<span class="n">zNodeMasked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">nodez</span><span class="p">,</span> <span class="n">upperz</span><span class="p">,</span> <span class="n">lowerz</span><span class="p">)</span>
				<span class="c1">#idMasked = self.mySimpleStack.slabList.id[~self.zMasked.mask]</span>
				<span class="n">xNodeMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">nodey</span><span class="p">[</span><span class="o">~</span><span class="n">zNodeMasked</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="c1"># swapping</span>
				<span class="n">yNodeMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">nodex</span><span class="p">[</span><span class="o">~</span><span class="n">zNodeMasked</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>

				<span class="n">maskedNodeDict</span> <span class="o">=</span> <span class="p">{</span>
					<span class="s1">&#39;zNodeMasked&#39;</span><span class="p">:</span> <span class="n">zNodeMasked</span><span class="p">,</span>
					<span class="s1">&#39;xNodeMasked&#39;</span><span class="p">:</span> <span class="n">xNodeMasked</span><span class="p">,</span>
					<span class="s1">&#39;yNodeMasked&#39;</span><span class="p">:</span> <span class="n">yNodeMasked</span><span class="p">,</span>
				<span class="p">}</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">maskedNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maskedNodeDict</span><span class="p">)</span>

				<span class="c1">#</span>
				<span class="c1"># edges</span>
				<span class="n">zMasked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">upperz</span><span class="p">,</span> <span class="n">lowerz</span><span class="p">)</span>

				<span class="c1">#todo: this need to be combined list of all slabs AND nodes,</span>
				<span class="c1">#when we click we can look up which was clicked</span>
				<span class="n">idMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="o">~</span><span class="n">zMasked</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
				<span class="n">xMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">zMasked</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="c1"># swapping</span>
				<span class="n">yMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">zMasked</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
				<span class="n">maskedEdgeDict</span> <span class="o">=</span> <span class="p">{</span>
					<span class="s1">&#39;idMasked&#39;</span><span class="p">:</span> <span class="n">idMasked</span><span class="p">,</span>
					<span class="s1">&#39;zMasked&#39;</span><span class="p">:</span> <span class="n">zMasked</span><span class="p">,</span>
					<span class="s1">&#39;xMasked&#39;</span><span class="p">:</span> <span class="n">xMasked</span><span class="p">,</span>
					<span class="s1">&#39;yMasked&#39;</span><span class="p">:</span> <span class="n">yMasked</span><span class="p">,</span>
				<span class="p">}</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">maskedEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maskedEdgeDict</span><span class="p">)</span>

				<span class="c1">#</span>
				<span class="c1"># slabs/edges dead ends</span>
				<span class="n">maskedDeadEndDict</span> <span class="o">=</span> <span class="p">{</span>
					<span class="s1">&#39;zMasked&#39;</span><span class="p">:</span> <span class="p">[],</span>
					<span class="s1">&#39;xMasked&#39;</span><span class="p">:</span> <span class="p">[],</span>
					<span class="s1">&#39;yMasked&#39;</span><span class="p">:</span> <span class="p">[],</span>
				<span class="p">}</span>
				<span class="k">for</span> <span class="n">edgeDict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">edgeDictList</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">edgeDict</span><span class="p">[</span><span class="s1">&#39;preNode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
						<span class="c1"># include dead end</span>
						<span class="c1"># get the z of the first slab</span>
						<span class="n">firstSlabIdx</span> <span class="o">=</span> <span class="n">edgeDict</span><span class="p">[</span><span class="s1">&#39;slabList&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
						<span class="n">tmpz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">firstSlabIdx</span><span class="p">]</span>
						<span class="k">if</span> <span class="n">tmpz</span> <span class="o">&gt;</span> <span class="n">upperz</span> <span class="ow">and</span> <span class="n">tmpz</span> <span class="o">&lt;</span> <span class="n">lowerz</span><span class="p">:</span>
							<span class="n">tmpx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">firstSlabIdx</span><span class="p">]</span>
							<span class="n">tmpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">firstSlabIdx</span><span class="p">]</span>
							<span class="n">maskedDeadEndDict</span><span class="p">[</span><span class="s1">&#39;yMasked&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpx</span><span class="p">)</span> <span class="c1"># swapping</span>
							<span class="n">maskedDeadEndDict</span><span class="p">[</span><span class="s1">&#39;xMasked&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpy</span><span class="p">)</span>
							<span class="n">maskedDeadEndDict</span><span class="p">[</span><span class="s1">&#39;zMasked&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpz</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">edgeDict</span><span class="p">[</span><span class="s1">&#39;postNode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
						<span class="c1"># include dead end</span>
						<span class="c1"># get the z of the last slab</span>
						<span class="n">lastSlabIdx</span> <span class="o">=</span> <span class="n">edgeDict</span><span class="p">[</span><span class="s1">&#39;slabList&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
						<span class="n">tmpz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">lastSlabIdx</span><span class="p">]</span>
						<span class="k">if</span> <span class="n">tmpz</span> <span class="o">&gt;</span> <span class="n">upperz</span> <span class="ow">and</span> <span class="n">tmpz</span> <span class="o">&lt;</span> <span class="n">lowerz</span><span class="p">:</span>
							<span class="n">tmpx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">lastSlabIdx</span><span class="p">]</span>
							<span class="n">tmpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">lastSlabIdx</span><span class="p">]</span>
							<span class="n">maskedDeadEndDict</span><span class="p">[</span><span class="s1">&#39;yMasked&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpx</span><span class="p">)</span> <span class="c1"># swapping</span>
							<span class="n">maskedDeadEndDict</span><span class="p">[</span><span class="s1">&#39;xMasked&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpy</span><span class="p">)</span>
							<span class="n">maskedDeadEndDict</span><span class="p">[</span><span class="s1">&#39;zMasked&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpz</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">maskedDeadEnds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maskedDeadEndDict</span><span class="p">)</span>

			<span class="c1">#print(&#39;slice&#39;, i, &#39;_preComputeAllMasks() len(x):&#39;, len(xMasked), &#39;len(y)&#39;, len(yMasked))</span>

<div class="viewcode-block" id="bStackView.setSlice"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.setSlice">[docs]</a>	<span class="k">def</span> <span class="nf">setSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recursion</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="c1">#print(&#39;bStackView.setSlice()&#39;, index)</span>

		<span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentSlice</span>

		<span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">numImages</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">numImages</span> <span class="o">-</span><span class="mi">1</span>

		<span class="n">showImage</span> <span class="o">=</span> <span class="kc">True</span>

		<span class="k">if</span> <span class="n">showImage</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">displaySlidingZ</span><span class="p">:</span>
				<span class="n">upSlices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Stack&#39;</span><span class="p">][</span><span class="s1">&#39;upSlidingZSlices&#39;</span><span class="p">]</span>
				<span class="n">downSlices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Stack&#39;</span><span class="p">][</span><span class="s1">&#39;downSlidingZSlices&#39;</span><span class="p">]</span>
				<span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">getSlidingZ</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span><span class="p">,</span> <span class="n">upSlices</span><span class="p">,</span> <span class="n">downSlices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minContrast</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxContrast</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;setSlice() index:&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
				<span class="c1">#image = self.mySimpleStack.getImage_ContrastEnhanced(self.minContrast, self.maxContrast, channel=1, sliceNum=index, useMaxProject=False)</span>
				<span class="c1"># works</span>
				<span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">setSliceContrast</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">thisStack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span><span class="p">,</span> <span class="n">minContrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minContrast</span><span class="p">,</span> <span class="n">maxContrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxContrast</span><span class="p">)</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgplot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;xxx.setSlice() is none&#39;</span><span class="p">)</span>
				<span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Stack&#39;</span><span class="p">][</span><span class="s1">&#39;colorLut&#39;</span><span class="p">]</span> <span class="c1">#2**2</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">imgplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iLeft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iBottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iTop</span><span class="p">])</span>  <span class="c1"># l, r, b, t</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">imgplot</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">pass</span>

		<span class="c1">#</span>
		<span class="c1"># update point annotations</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showTracing</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="c1"># no tracing</span>
				<span class="k">pass</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1">#try:</span>
				<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
					<span class="c1"># nodes</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showNodes</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">myNodePlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">maskedNodes</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;xNodeMasked&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskedNodes</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;yNodeMasked&#39;</span><span class="p">]])</span>
					<span class="c1"># slabs</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showEdges</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">mySlabPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">maskedEdges</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;xMasked&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskedEdges</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;yMasked&#39;</span><span class="p">]])</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showDeadEnds</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">myDeadEndPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">maskedDeadEnds</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;xMasked&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskedDeadEnds</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;yMasked&#39;</span><span class="p">]])</span>
				<span class="c1">#except:</span>
				<span class="c1">#	print(&#39;ERROR: bStackWindow.setSlice&#39;)</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myNodePlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[],</span> <span class="p">[]])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mySlabPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[[],</span> <span class="p">[]])</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">currentSlice</span> <span class="o">=</span> <span class="n">index</span> <span class="c1"># update slice</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">recursion</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;set slice&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

		<span class="c1">#self.canvas.draw()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
		<span class="c1">#self.repaint() # this is updating the widget !!!!!!!!</span>
		<span class="c1">#print(1)</span>

<div class="viewcode-block" id="bStackView.zoomToPoint"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.zoomToPoint">[docs]</a>	<span class="k">def</span> <span class="nf">zoomToPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
		<span class="c1"># todo convert this to use a % of the total image ?</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zoomToPoint() x:&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		zoomPixels = 20</span>
<span class="sd">		left = x - zoomPixels</span>
<span class="sd">		top = y - zoomPixels # flip ?</span>
<span class="sd">		right = x + zoomPixels</span>
<span class="sd">		bottom = y + zoomPixels # flip?</span>
<span class="sd">		width = right - left</span>
<span class="sd">		height = bottom - top</span>
<span class="sd">		print(&#39;   &#39;, left, top, right, bottom, &#39;width:&#39;, width, &#39;height:&#39;, height)</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="c1"># this sort of works</span>
		<span class="c1">#self.scale(2, 2)</span>
		<span class="n">scenePnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToScene</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
		<span class="n">scenePnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   scenePnt:&#39;</span><span class="p">,</span> <span class="n">scenePnt</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">centerOn</span><span class="p">(</span><span class="n">scenePnt</span><span class="p">)</span>

		<span class="c1">#self.centerOn(x, y)</span>

		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		self.canvas.draw()</span>
<span class="sd">		self.repaint() # this is updating the widget !!!!!!!!</span>
<span class="sd">		&#39;&#39;&#39;</span></div>

<div class="viewcode-block" id="bStackView.zoom"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.zoom">[docs]</a>	<span class="k">def</span> <span class="nf">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom</span><span class="p">):</span>
		<span class="c1">#print(&#39;=== bStackView.zoom()&#39;, zoom)</span>
		<span class="k">if</span> <span class="n">zoom</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
			<span class="n">scale</span> <span class="o">=</span> <span class="mf">1.2</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">scale</span> <span class="o">=</span> <span class="mf">0.8</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span></div>
		<span class="c1">#self.zoomToPoint(100,100)</span>

<div class="viewcode-block" id="bStackView.keyPressEvent"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.keyPressEvent">[docs]</a>	<span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
		<span class="c1">#print(&#39;=== bStackView.keyPressEvent() event.key():&#39;, event.key())</span>
		<span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Plus</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Equal</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Minus</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_T</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">showTracing</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showTracing</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">()</span> <span class="c1">#refresh</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_N</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">showNodes</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showNodes</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">()</span> <span class="c1">#refresh</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_E</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">showEdges</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showEdges</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">()</span> <span class="c1">#refresh</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_D</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">showDeadEnds</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showDeadEnds</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">()</span> <span class="c1">#refresh</span>

		<span class="c1"># choose which stack to display</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_1</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span> <span class="o">=</span> <span class="s1">&#39;ch1&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># just refresh</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_2</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span> <span class="o">=</span> <span class="s1">&#39;ch2&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># just refresh</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_3</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span> <span class="o">=</span> <span class="s1">&#39;ch3&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># just refresh</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_9</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">_imagesMask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span> <span class="o">=</span> <span class="s1">&#39;mask&#39;</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># just refresh</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_0</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">_imagesSkel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">displayThisStack</span> <span class="o">=</span> <span class="s1">&#39;skel&#39;</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># just refresh</span>

		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Z</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_toggleSlidingZ</span><span class="p">()</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="n">event</span><span class="o">.</span><span class="n">setAccepted</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

	<span class="k">def</span> <span class="nf">_toggleSlidingZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursion</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">displaySlidingZ</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">displaySlidingZ</span>
		<span class="c1"># todo: don&#39;t call this deep</span>
		<span class="k">if</span> <span class="n">recursion</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">bStackFeebackWidget</span><span class="o">.</span><span class="n">setFeedback</span><span class="p">(</span><span class="s1">&#39;sliding z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">displaySlidingZ</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># just refresh</span>

<div class="viewcode-block" id="bStackView.wheelEvent"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.wheelEvent">[docs]</a>	<span class="k">def</span> <span class="nf">wheelEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
		<span class="c1">#if self.hasPhoto():</span>

		<span class="c1">#print(&#39;event.angleDelta().y():&#39;, event.angleDelta().y())</span>

		<span class="n">modifiers</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">keyboardModifiers</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">modifiers</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">angleDelta</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
			<span class="n">event</span><span class="o">.</span><span class="n">setAccepted</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">angleDelta</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">currentSlice</span> <span class="o">-=</span> <span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">currentSlice</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentSlice</span><span class="p">)</span>
			<span class="n">event</span><span class="o">.</span><span class="n">setAccepted</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="bStackView.mousePressEvent"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.mousePressEvent">[docs]</a>	<span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== bStackView.mousePressEvent()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clickPos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
		<span class="n">event</span><span class="o">.</span><span class="n">setAccepted</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="bStackView.mouseMoveEvent"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.mouseMoveEvent">[docs]</a>	<span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
		<span class="c1">#print(&#39;=== bStackView.mouseMoveEvent()&#39;)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clickPos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">newPos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">clickPos</span>
			<span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clickPos</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="n">newPos</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
			<span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clickPos</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="n">newPos</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
		<span class="n">event</span><span class="o">.</span><span class="n">setAccepted</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="bStackView.mouseReleaseEvent"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.mouseReleaseEvent">[docs]</a>	<span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
		<span class="c1">#print(&#39;=== bStackView.mouseReleaseEvent()&#39;)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clickPos</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
		<span class="n">event</span><span class="o">.</span><span class="n">setAccepted</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="bStackView.onpick"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.onpick">[docs]</a>	<span class="k">def</span> <span class="nf">onpick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">=== bStackView.onpick()&#39;</span><span class="p">)</span>
		<span class="n">xdata</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">xdata</span>
		<span class="n">ydata</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">ydata</span>
		<span class="n">ind</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>

		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		print(&#39;   event.mouseevent.xdata:&#39;, event.mouseevent.xdata)</span>
<span class="sd">		print(&#39;   event.mouseevent.ydata:&#39;, event.mouseevent.ydata)</span>
<span class="sd">		print(&#39;   event.artist:&#39;, event.artist)</span>
<span class="sd">		print(&#39;   event.ind:&#39;, event.ind)</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="c1"># find the first ind in bSlabList.id</span>
		<span class="n">firstInd</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="c1">#edgeIdx = self.mySimpleStack.slabList.id[firstInd]</span>
		<span class="c1">#edgeIdx = self.idMasked[firstInd]</span>

		<span class="n">edgeIdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskedEdges</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currentSlice</span><span class="p">][</span><span class="s1">&#39;idMasked&#39;</span><span class="p">][</span><span class="n">firstInd</span><span class="p">]</span>
		<span class="n">edgeIdx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">edgeIdx</span><span class="p">)</span>


		<span class="c1">#edgeIdx += 1</span>

		<span class="c1">#print(&#39;   firstInd:&#39;, firstInd, &#39;edgeIdx:&#39;, edgeIdx)</span>

		<span class="c1">#self.selectEdge(edgeIdx)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   edge:&#39;</span><span class="p">,</span> <span class="n">edgeIdx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="o">.</span><span class="n">edgeDictList</span><span class="p">[</span><span class="n">edgeIdx</span><span class="p">])</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;selectEdgeFromImage&#39;</span><span class="p">,</span> <span class="n">edgeIdx</span><span class="p">)</span></div>

<div class="viewcode-block" id="bStackView.options_defaults"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackView.options_defaults">[docs]</a>	<span class="k">def</span> <span class="nf">options_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Possible values are: Accent, Accent_r, Blues, Blues_r, BrBG, BrBG_r, BuGn, BuGn_r, BuPu, BuPu_r, CMRmap, CMRmap_r, Dark2, Dark2_r, GnBu, GnBu_r, Greens, Greens_r, Greys, Greys_r, OrRd, OrRd_r, Oranges, Oranges_r, PRGn, PRGn_r, Paired, Paired_r, Pastel1, Pastel1_r, Pastel2, Pastel2_r, PiYG, PiYG_r, PuBu, PuBuGn, PuBuGn_r, PuBu_r, PuOr, PuOr_r, PuRd, PuRd_r, Purples, Purples_r, RdBu, RdBu_r, RdGy, RdGy_r, RdPu, RdPu_r, RdYlBu, RdYlBu_r, RdYlGn, RdYlGn_r, Reds, Reds_r, Set1, Set1_r, Set2, Set2_r, Set3, Set3_r, Spectral, Spectral_r, Wistia, Wistia_r, YlGn, YlGnBu, YlGnBu_r, YlGn_r, YlOrBr, YlOrBr_r, YlOrRd, YlOrRd_r, afmhot, afmhot_r, autumn, autumn_r, binary, binary_r, bone, bone_r, brg, brg_r, bwr, bwr_r, cividis, cividis_r, cool, cool_r, coolwarm, coolwarm_r, copper, copper_r, cubehelix, cubehelix_r, flag, flag_r, gist_earth, gist_earth_r, gist_gray, gist_gray_r, gist_heat, gist_heat_r, gist_ncar, gist_ncar_r, gist_rainbow, gist_rainbow_r, gist_stern, gist_stern_r, gist_yarg, gist_yarg_r, gnuplot, gnuplot2, gnuplot2_r, gnuplot_r, gray, gray_r, hot, hot_r, hsv, hsv_r, inferno, inferno_r, jet, jet_r, magma, magma_r, nipy_spectral, nipy_spectral_r, ocean, ocean_r, pink, pink_r, plasma, plasma_r, prism, prism_r, rainbow, rainbow_r, seismic, seismic_r, spring, spring_r, summer, summer_r, tab10, tab10_r, tab20, tab20_r, tab20b, tab20b_r, tab20c, tab20c_r, terrain, terrain_r, twilight, twilight_r, twilight_shifted, twilight_shifted_r, viridis, viridis_r, winter, winter_r</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Stack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Stack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({</span>
			<span class="s1">&#39;colorLut&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span>
			<span class="s1">&#39;upSlidingZSlices&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
			<span class="s1">&#39;downSlidingZSlices&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
			<span class="p">})</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Tracing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({</span>
			<span class="s1">&#39;nodePenSize&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
			<span class="s1">&#39;nodeColor&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
			<span class="s1">&#39;nodeSelectionPenSize&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
			<span class="s1">&#39;nodeSelectionColor&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
			<span class="s1">&#39;nodeSelectionFlashPenSize&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
			<span class="s1">&#39;nodeSelectionFlashColor&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
			<span class="s1">&#39;showTracingAboveSlices&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
			<span class="s1">&#39;showTracingBelowSlices&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
			<span class="s1">&#39;tracingPenSize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
			<span class="s1">&#39;tracingColor&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span>
			<span class="s1">&#39;tracingSelectionPenSize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
			<span class="s1">&#39;tracingSelectionColor&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
			<span class="s1">&#39;tracingSelectionFlashPenSize&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
			<span class="s1">&#39;tracingSelectionFlashColor&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
			<span class="s1">&#39;deadEndPenSize&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
			<span class="s1">&#39;deadEndColor&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
			<span class="p">})</span></div></div>

<span class="c1">################################################################################</span>
<div class="viewcode-block" id="bStackWidget"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget">[docs]</a><span class="k">class</span> <span class="nc">bStackWidget</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A widget to display a stack. This includes a bStackView and a bAnnotationTable.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">bStackWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

		<span class="c1">#self.options_defaults()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

		<span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;bStackWidget0&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">			#bStackWidget0 {</span>
<span class="s2">				background-color: #222;</span>
<span class="s2">			}</span>
<span class="s2">			.QLabel {</span>
<span class="s2">				color: #bbb;</span>
<span class="s2">			}</span>
<span class="s2">			.QCheckBox {</span>
<span class="s2">				color: #bbb;</span>
<span class="s2">			}</span>
<span class="s2">		&quot;&quot;&quot;</span><span class="p">)</span>

		<span class="c1">#</span>
		<span class="c1">#self.mySimpleStack = bSimpleStack(path) # backend stack</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span> <span class="o">=</span> <span class="n">bStack</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1"># backend stack</span>
		<span class="c1">#</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">showLeftControlBar</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">showContrastBar</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">showFeebackBar</span> <span class="o">=</span> <span class="kc">True</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myHBoxLayout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myVBoxLayout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myContrastWidget</span> <span class="o">=</span> <span class="n">bStackContrastWidget</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">bStackFeebackWidget</span> <span class="o">=</span> <span class="n">bStackFeebackWidget</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bStackFeebackWidget</span><span class="o">.</span><span class="n">setFeedback</span><span class="p">(</span><span class="s1">&#39;num slices&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">numImages</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myHBoxLayout2</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span> <span class="o">=</span> <span class="n">bStackView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># a visual stack</span>

		<span class="c1"># a slider to set slice number</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSlider</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">numImages</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># so it goes from top:0 to bottom:numImages</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliceSliderValueChanged</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myHBoxLayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myHBoxLayout2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span><span class="p">)</span>

		<span class="c1"># add</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myVBoxLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myContrastWidget</span><span class="p">)</span> <span class="c1">#, stretch=0.1)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myVBoxLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bStackFeebackWidget</span><span class="p">)</span> <span class="c1">#, stretch=0.1)</span>
		<span class="c1">#self.myVBoxLayout.addWidget(self.myStackView) #, stretch = 9)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myVBoxLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myHBoxLayout2</span><span class="p">)</span> <span class="c1">#, stretch = 9)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">annotationTable</span> <span class="o">=</span> <span class="n">bAnnotationTable</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">slabList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">slabList</span><span class="p">)</span>
		<span class="c1">#self.verticalSpacer = QtWidgets.QSpacerItem(20, 40, QtWidgets.QSizePolicy.Minimum, QtWidgets.QSizePolicy.Expanding)</span>


		<span class="bp">self</span><span class="o">.</span><span class="n">myHBoxLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotationTable</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># stretch=10, not sure on the units???</span>
		<span class="c1">#self.myHBoxLayout.addItem(self.verticalSpacer)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myHBoxLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myVBoxLayout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span> <span class="c1"># stretch=10, not sure on the units???</span>

		<span class="c1">#self.connect(self.myHBoxLayout, QtCore.SIGNAL(&quot;dropped&quot;), self.dropEvent)</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		self.setFocusPolicy(QtCore.Qt.ClickFocus)</span>
<span class="sd">		self.setFocus()</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">updateDisplayedWidgets</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="bStackWidget.sliceSliderValueChanged"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.sliceSliderValueChanged">[docs]</a>	<span class="k">def</span> <span class="nf">sliceSliderValueChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">theSlice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;set slice&#39;</span><span class="p">,</span> <span class="n">theSlice</span><span class="p">)</span></div>

<div class="viewcode-block" id="bStackWidget.updateDisplayedWidgets"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.updateDisplayedWidgets">[docs]</a>	<span class="k">def</span> <span class="nf">updateDisplayedWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># left control bar</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showLeftControlBar</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">annotationTable</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">annotationTable</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
		<span class="c1"># contrast bar</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showContrastBar</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myContrastWidget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myContrastWidget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
		<span class="c1"># feedback bar</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showFeebackBar</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">bStackFeebackWidget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">bStackFeebackWidget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>


	<span class="c1"># get rid of this</span>
<div class="viewcode-block" id="bStackWidget.getStack"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.getStack">[docs]</a>	<span class="k">def</span> <span class="nf">getStack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span></div>

<div class="viewcode-block" id="bStackWidget.signal"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.signal">[docs]</a>	<span class="k">def</span> <span class="nf">signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fromTable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recursion</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="c1">#print(&#39;=== bStackWidget.signal()&#39;, &#39;signal:&#39;, signal, &#39;value:&#39;, value, &#39;fromTable:&#39;, fromTable)</span>
		<span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s1">&#39;selectNodeFromTable&#39;</span><span class="p">:</span>
			<span class="n">nodeIdx</span> <span class="o">=</span> <span class="n">value</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== bStackWidget.signal() selectNodeFromTable nodeIdx:&#39;</span><span class="p">,</span> <span class="n">nodeIdx</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">selectNode</span><span class="p">(</span><span class="n">nodeIdx</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			if not fromTable:</span>
<span class="sd">				self.annotationTable.selectRow(nodeIdx)</span>
<span class="sd">			&#39;&#39;&#39;</span>
			<span class="c1">#self.myStackView.selectNode(nodeIdx, snapz=True)</span>

		<span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s1">&#39;selectEdgeFromTable&#39;</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== bStackWidget.signal() selectEdgeFromTable&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">selectEdge</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">fromTable</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">annotationTable</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s1">&#39;selectEdgeFromImage&#39;</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== bStackWidget.signal() selectEdgeFromImage&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">selectEdge</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">fromTable</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">annotationTable</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s1">&#39;contrast change&#39;</span><span class="p">:</span>
			<span class="n">minContrast</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;minContrast&#39;</span><span class="p">]</span>
			<span class="n">maxContrast</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;maxContrast&#39;</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">minContrast</span> <span class="o">=</span> <span class="n">minContrast</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">maxContrast</span> <span class="o">=</span> <span class="n">maxContrast</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># will just refresh current slice</span>

		<span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s1">&#39;set slice&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">bStackFeebackWidget</span><span class="o">.</span><span class="n">setFeedback</span><span class="p">(</span><span class="s1">&#39;set slice&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">recursion</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">recursion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mySliceSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s1">&#39;toggle sliding z&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">_toggleSlidingZ</span><span class="p">(</span><span class="n">recursion</span><span class="o">=</span><span class="n">recursion</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="s1">&#39;save&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">saveAnnotations</span><span class="p">()</span></div>

<div class="viewcode-block" id="bStackWidget.selectNode"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.selectNode">[docs]</a>	<span class="k">def</span> <span class="nf">selectNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeIdx</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bStackWidget.selectNode() nodeIdx:&#39;</span><span class="p">,</span> <span class="n">nodeIdx</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">selectNode</span><span class="p">(</span><span class="n">nodeIdx</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="n">snapz</span><span class="p">)</span></div>
		<span class="c1">#self.repaint() # this is updating the widget !!!!!!!!</span>

<div class="viewcode-block" id="bStackWidget.selectEdge"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.selectEdge">[docs]</a>	<span class="k">def</span> <span class="nf">selectEdge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgeIdx</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bStackWidget.selectEdge() edgeIdx:&#39;</span><span class="p">,</span> <span class="n">edgeIdx</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">selectEdge</span><span class="p">(</span><span class="n">edgeIdx</span><span class="p">,</span> <span class="n">snapz</span><span class="o">=</span><span class="n">snapz</span><span class="p">)</span></div>
		<span class="c1">#self.repaint() # this is updating the widget !!!!!!!!</span>

<div class="viewcode-block" id="bStackWidget.keyPressEvent"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.keyPressEvent">[docs]</a>	<span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
		<span class="c1">#print(&#39;=== bStackWidget.keyPressEvent() event.key():&#39;, event.key())</span>
		<span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Escape</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">selectEdge</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_L</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">showLeftControlBar</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showLeftControlBar</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">updateDisplayedWidgets</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_C</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">showContrastBar</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showContrastBar</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">updateDisplayedWidgets</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_F</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">showFeebackBar</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showFeebackBar</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">updateDisplayedWidgets</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_H</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">printHelp</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_B</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;set selected edge to bad&#39;</span><span class="p">)</span>
			<span class="n">selectedEdge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">mySelectedEdge</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mySimpleStack</span><span class="o">.</span><span class="n">setAnnotation</span><span class="p">(</span><span class="s1">&#39;toggle bad edge&#39;</span><span class="p">,</span> <span class="n">selectedEdge</span><span class="p">)</span>
			<span class="c1"># force refresh of table, I need to use model/view/controller !!!!</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">annotationTable</span><span class="o">.</span><span class="n">refreshRow</span><span class="p">(</span><span class="n">selectedEdge</span><span class="p">)</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bStackWidget.keyPressEvent() not handled&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">text</span><span class="p">())</span></div>

<div class="viewcode-block" id="bStackWidget.printHelp"><a class="viewcode-back" href="../../bimpy.html#bimpy.bStackWidget.bStackWidget.printHelp">[docs]</a>	<span class="k">def</span> <span class="nf">printHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=============================================================&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bStackWidget help&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==============================================================&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Navigation&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   mouse wheel: scroll through images&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   command + mouse wheel: zoom in/out (follows mouse position)&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   +/-: zoom in/out (follows mouse position)&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   click + drag: pan&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Show/Hide interface&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   t: show/hide tracing&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   l: show/hide list of annotations&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   c: show/hide contrast bar&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   f: show/hide feedback bar&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   esc: remove edge selection (cyan)&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Stacks To Display&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   1: Channel 1 - Raw Data&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   2: Channel 2 - Raw Data&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   3: Channel 3 - Raw Data&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   9: Segmentation mask - DeepVess&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   0: Skeleton mask - DeepVess&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Sliding Z-Projection&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   z: toggle sliding z-projection on/off, will apply to all &quot;Stacks To Display&quot;&#39;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="p">)</span></div>


	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	def mousePressEvent(self, event):</span>
<span class="sd">		print(&#39;=== bStackWidget.mousePressEvent()&#39;)</span>
<span class="sd">		super().mousePressEvent(event)</span>
<span class="sd">		self.myStackView.mousePressEvent(event)</span>
<span class="sd">		event.setAccepted(False)</span>
<span class="sd">	def mouseMoveEvent(self, event):</span>
<span class="sd">		#print(&#39;=== bStackWidget.mouseMoveEvent()&#39;)</span>
<span class="sd">		super().mouseMoveEvent(event)</span>
<span class="sd">		self.myStackView.mouseMoveEvent(event)</span>
<span class="sd">		event.setAccepted(False)</span>
<span class="sd">	def mouseReleaseEvent(self, event):</span>
<span class="sd">		print(&#39;=== bStackWidget.mouseReleaseEvent()&#39;)</span>
<span class="sd">		super().mouseReleaseEvent(event)</span>
<span class="sd">		self.myStackView.mousePressEvent(event)</span>
<span class="sd">		event.setAccepted(False)</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	def dragEnterEvent(self, event):</span>
<span class="sd">		#print(&#39;dragEnterEvent:&#39;, event)</span>
<span class="sd">		if event.mimeData().hasUrls:</span>
<span class="sd">			event.setDropAction(QtCore.Qt.CopyAction)</span>
<span class="sd">			event.accept()</span>
<span class="sd">		else:</span>
<span class="sd">			event.ignore()</span>

<span class="sd">	def dragMoveEvent(self, event):</span>
<span class="sd">		#print(&#39;dragMoveEvent:&#39;, event)</span>
<span class="sd">		if event.mimeData().hasUrls:</span>
<span class="sd">			event.setDropAction(QtCore.Qt.CopyAction)</span>
<span class="sd">			event.accept()</span>
<span class="sd">		else:</span>
<span class="sd">			event.ignore()</span>

<span class="sd">	def dropEvent(self, event):</span>
<span class="sd">		print(&#39;dropEvent:&#39;, event)</span>
<span class="sd">		if event.mimeData().hasUrls:</span>
<span class="sd">			for url in event.mimeData().urls():</span>
<span class="sd">				print(&#39;   &#39;, url.toLocalFile())</span>
<span class="sd">		else:</span>
<span class="sd">			event.ignore()</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	def onkey(self, event):</span>
<span class="sd">		print(&#39;bStackWindow.onkey()&#39;, event.key)</span>
<span class="sd">		key = event.key</span>

<span class="sd">	def onclick(self, event):</span>
<span class="sd">		print(&#39;bStackWindow.onclick()&#39;, event.button, event.x, event.y, event.xdata, event.ydata)</span>

<span class="sd">	def onscroll(self, event):</span>
<span class="sd">		if event.button == &#39;up&#39;:</span>
<span class="sd">			self.currentSlice -= 1</span>
<span class="sd">		elif event.button == &#39;down&#39;:</span>
<span class="sd">			self.currentSlice += 1</span>
<span class="sd">		self.setSlice(self.currentSlice)</span>

<span class="sd">	def onpick(self, event):</span>
<span class="sd">		print(&#39;bStackWindow.onpick()&#39;, event.ind)</span>
<span class="sd">	&#39;&#39;&#39;</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">sys</span>

	<span class="c1">#path = &#39;/Users/cudmore/box/DeepVess/data/invivo/20190613__0028.tif&#39;</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/Users/cudmore/box/DeepVess/data/immuno-stack/mytest.tif&#39;</span>
		<span class="c1">#path = &#39;/Users/cudmore/box/DeepVess/data/invivo/20190613__0028.tif&#39;</span>

	<span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

	<span class="n">sw</span> <span class="o">=</span> <span class="n">bStackWidget</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">app</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
	<span class="n">sw</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
	<span class="n">sw</span><span class="o">.</span><span class="n">myStackView</span><span class="o">.</span><span class="n">setSlice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	sw2 = bStackWidget(mainWindow=app, parent=None, path=path)</span>
<span class="sd">	sw2.show()</span>
<span class="sd">	sw2.setSlice(0)</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="c1">#print(&#39;app.topLevelWidgets():&#39;, app.topLevelWidgets())</span>

	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">bImPy</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Robert H Cudmore.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>